from itertools import product
{
  "pools": [
    {
      "rolls": 1,
      "entries": [
        for animal in ctx.meta['animals']:
          for animal_type, animal_name in product((animal['type'],), animal['names'].split(',').strip())
          {
            "type": "minecraft:item",
            "name": "minecraft:lead",
            "functions": [
              {
                "function": "minecraft:copy_nbt",
                "source": {
                  "type": "minecraft:storage",
                  "source": "gm4_balloon_animals:temp"
                },
                "ops": [
                  {
                    "source": "trade_metadata",
                    "target": "trade_metadata",
                    "op": "replace"
                  }
                ]
              },
              {
                "function": "minecraft:set_name",
                "entity": "this",
                "name": animal_type,
                "conditions": [
                  {
                    "condition": "minecraft:value_check",
                    "value": {
                      "type": "minecraft:score",
                      "target": {
                        "type": "minecraft:fixed",
                        "name": "$animal_id"
                      },
                      "score": "gm4_balloon_animals_data"
                    },
                    "range": ctx.meta['enumeration'].index(animal_type)
                  }
                ]
              },
              {
                "function": "minecraft:set_lore",
                "entity": "this",
                "lore": [
                  {
                    "text": animal_name,
                    "color": "gray",
                    "italic": false
                  }
                ]
              }
            ]
          }
      ]
    }
  ]
}
