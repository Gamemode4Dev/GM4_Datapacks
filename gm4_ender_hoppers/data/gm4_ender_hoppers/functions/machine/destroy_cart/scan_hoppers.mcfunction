# searches for hoppers with invalid items
# @s = ender_hopper marker
# located at @s
# run from gm4_ender_hoppers:machine/destroy_cart

# find hopper with the invalid item
scoreboard players set $found_item gm4_machine_data 0
execute if score $found_item gm4_machine_data matches 0 positioned ~00 ~00 ~00 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper
execute if score $found_item gm4_machine_data matches 0 positioned ~01 ~00 ~00 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper
execute if score $found_item gm4_machine_data matches 0 positioned ~-1 ~00 ~00 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper
execute if score $found_item gm4_machine_data matches 0 positioned ~00 ~00 ~01 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper
execute if score $found_item gm4_machine_data matches 0 positioned ~01 ~00 ~01 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper
execute if score $found_item gm4_machine_data matches 0 positioned ~-1 ~00 ~01 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper
execute if score $found_item gm4_machine_data matches 0 positioned ~00 ~00 ~-1 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper
execute if score $found_item gm4_machine_data matches 0 positioned ~01 ~00 ~-1 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper
execute if score $found_item gm4_machine_data matches 0 positioned ~-1 ~00 ~-1 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper

execute if score $found_item gm4_machine_data matches 0 positioned ~00 ~-1 ~00 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper
execute if score $found_item gm4_machine_data matches 0 positioned ~01 ~-1 ~00 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper
execute if score $found_item gm4_machine_data matches 0 positioned ~-1 ~-1 ~00 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper
execute if score $found_item gm4_machine_data matches 0 positioned ~00 ~-1 ~01 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper
execute if score $found_item gm4_machine_data matches 0 positioned ~01 ~-1 ~01 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper
execute if score $found_item gm4_machine_data matches 0 positioned ~-1 ~-1 ~01 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper
execute if score $found_item gm4_machine_data matches 0 positioned ~00 ~-1 ~-1 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper
execute if score $found_item gm4_machine_data matches 0 positioned ~01 ~-1 ~-1 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper
execute if score $found_item gm4_machine_data matches 0 positioned ~-1 ~-1 ~-1 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper

execute if score $found_item gm4_machine_data matches 0 positioned ~00 ~-2 ~00 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper
execute if score $found_item gm4_machine_data matches 0 positioned ~01 ~-2 ~00 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper
execute if score $found_item gm4_machine_data matches 0 positioned ~-1 ~-2 ~00 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper
execute if score $found_item gm4_machine_data matches 0 positioned ~00 ~-2 ~01 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper
execute if score $found_item gm4_machine_data matches 0 positioned ~01 ~-2 ~01 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper
execute if score $found_item gm4_machine_data matches 0 positioned ~-1 ~-2 ~01 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper
execute if score $found_item gm4_machine_data matches 0 positioned ~00 ~-2 ~-1 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper
execute if score $found_item gm4_machine_data matches 0 positioned ~01 ~-2 ~-1 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper
execute if score $found_item gm4_machine_data matches 0 positioned ~-1 ~-2 ~-1 if block ~ ~ ~ hopper{Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]} run function gm4_ender_hoppers:machine/destroy_cart/update_hopper

# if no hoppers found, find hopper minecarts with the invalid item
execute if score $found_item gm4_machine_data matches 0 as @e[type=hopper_minecart,distance=..3,nbt={Items:[{id:"minecraft:hopper_minecart",tag:{display:{Name:'{"translate":"gm4.second","fallback":"%1$s","with":[{"translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"},{"color":"white","font":"gm4:container_gui","extra":[{"color":"#404040","font":"gm4:default","translate":"container.gm4.ender_hopper_minecart","fallback":"Ender Hopper Minecart"}],"translate":"gui.gm4.ender_hopper_minecart","fallback":""}]}'}}}]}] run function gm4_ender_hoppers:machine/destroy_cart/update_hopper_minecart
